<view class="main-content">
  <view class="back-button" bindtap="onBack">
    <svg src="/assets/back.svg" color="white" width="13px" height="13px"></svg>
  </view>
  <view class="content-wrapper">
    <text class="h1">我的锦标赛记录</text>
    <view class="hr" />
    <!-- 基础输入 -->
    <view class="display-row">
      <view class="w-100">
        <custom-select
          options="{{levelTypes}}"
          selected=""
          title="关卡"
          bind:select="onLevelTypeChange"
        />
      </view>
    </view>
    <!-- 动作按钮 -->
    <view id="action-buttons" class="display-row">
      <button
        id="fetch-records"
        class="btn upload-fetch-btn w-100"
        bindtap="getRecords"
      >
        获取记录
      </button>
    </view>

    <view wx:if="{{editFormVisible}}">
      <view class="hr" />
      <upload-form id="upload-form" initial-data="{{recordToEdit}}" battle-type="championships"></upload-form>
      <view class="display-row">
        <button class="btn cancel-btn w-50" bindtap="handleCancelEdit">取消</button>
        <button class="btn submit-btn w-50" bindtap="handleUpdateRecord">更新记录</button>
      </view>
    </view>

    <view class="hr" />
    <!-- 展示最新记录 -->
    <view id="latest-records-wrapper" wx:if="{{latestRecordsVisible}}">
      <view class="total-cnt-row">
        我的锦标赛数据总量：<text id="total-db-records-cnt"
          >{{totalDbRecordsCnt > 0 ? totalDbRecordsCnt : '加载中'}}</text
        >。
      </view>
      <view id="latest-records">
        <view class="record-wrapper" wx:for="{{latestRecords}}" wx:key="index">
          <record record="{{item}}" record-id="{{item.id}}" show-admin-actions="{{true}}" bind:delete="handleDeleteRecord" bind:edit="handleEditRecord"></record>
        </view>
      </view>
    </view>
    <!-- 展示记录 -->
    <view id="records-wrapper" wx:if="{{recordsVisible}}">
      <view id="records">
        <view class="record-wrapper" wx:for="{{records}}" wx:key="index">
          <record record="{{item}}" record-id="{{item.id}}" show-admin-actions="{{true}}" bind:delete="handleDeleteRecord"></record>
        </view>
      </view>
      <view id="pagination" wx:if="{{totalPage > 0}}">
        <button
          wx:for="{{pages}}"
          wx:key="*this"
          class="btn mx-1 page-btn {{item == currentPage ? 'page-btn-selected' : '' }}"
          bindtap="onPageChange"
          data-page="{{item}}"
        >
          {{item}}
        </button>
      </view>
    </view>
    <toast id="toast"></toast>
    <announcement id="announcement"></announcement>
  </view>
  <footer />
</view>
