<view class="record-container">
  <info class="cp-info" id="cp_info"></info>
  <view class="star-rank display-row" wx:if="{{record['模式']=='波动'}}">
    <block wx:for="{{[0,1,2]}}" wx:key="*this">
      <svg
        class="star-icon"
        src="/assets/star-fill.svg"
        width="20px"
        height="20px"
        color="#f7b257"
        wx:if="{{index < getStarRank}}"
      ></svg>
    </block>
  </view>
  <view class="w-100 record" data-id="{{recordId}}">
    <view class="row">
      <view class="w-50 record-matching-detail record-grid">
        <block
          wx:if="{{record['对谱'] !== '不确定' && record['对谱加成'] !== '不确定'}}"
        >
          <view class="record-matching {{getMatchingClass}}"
            >{{record['对谱']}}</view
          >
          <block wx:for="{{[0,1,2,3,4,5]}}" wx:key="*this">
            <svg
              class="record-matching-circle"
              src="/assets/circle-fill.svg"
              width="14px"
              height="14px"
              color="{{getMatchingColor}}"
              wx:if="{{index < getMatchingCount}}"
            ></svg>
            <svg
              class="record-matching-circle"
              src="/assets/circle.svg"
              width="14px"
              height="14px"
              color="{{getMatchingColor}}"
              wx:if="{{index >= getMatchingCount}}"
            ></svg>
          </block>
        </block>
        <block wx:else>无对谱信息</block>
      </view>
      <view class="w-50 record-level-detail record-grid">
        <view>{{getLevelDisplay}}</view>
      </view>
    </view>
    <view wx:if="{{noBuffedCP !== 0}}" class="row cp-container">
      <view class="w-50 cp-left-column record-cp-detail">
        <!-- <view class="cp-score-row">
            <view class="battle-icon"><image src="/assets/battle.png" style="width:40px;height: 40px;"></image></view>
            <view class="cp-left-column">                
                <label class="record-cp-label">{{buffedCP}}</label>
                <view class="record-raw-cp-label-row">            
                    {{noBuffedCP}}
                    <svg class="info" src="/assets/question.svg" width="11px" height="11px" color="#ffffffbd" bind:tap="onCPSectionTap"></svg>
                </view>
            </view>
        </view> -->
        <label class="record-cp-label">{{buffedCP}}</label>
        <view class="record-raw-cp-label-row">
          {{noBuffedCP}}
          <view
            wx:if="{{cpEvaluation}}"
            class="cp-evaluation-label {{cpEvaluationClass}}"
            >{{cpEvaluation}}</view
          >
          <svg
            class="info"
            src="/assets/question.svg"
            width="11px"
            height="11px"
            color="#ffffffbd"
            bind:tap="onCPSectionTap"
          ></svg>
        </view>
      </view>
      <view class="w-50 cp-right-column">
        <view class="cp-right-row record-grid-padding-left">
          <label class="record-text-label"
            >暴击期: {{nonWeakenCPPercentage}}%</label
          >
          <view
            class="record-cp-progress-bar record-value-label"
            style="background: linear-gradient(to right, #f4d266 0%, #f6cd63 100%); width: {{nonWeakenCPProgressBarWidth}}%"
          ></view>
        </view>
        <view class="cp-right-row record-grid-padding-left record-cp-detail">
          <label class="record-text-label"
            >虚弱期: {{weakenCPPercentage}}%</label
          >
          <view
            class="record-cp-progress-bar record-value-label"
            style="background: linear-gradient(to right, #b0dee9 0%, #87c4d2 100%); width: {{weakenCPProgressBarWidth}}%"
          ></view>
        </view>
      </view>
    </view>
    <block wx:else>
      <view class="row">
        <view class="w-50 record-grid record-cp-detail">未支持的搭档</view>
        <view class="w-50 record-grid record-cp-detail"></view>
      </view>
    </block>
    <view class="row">
      <view class="w-50 record-grid record-grid-padding-right">
        <view class="record-partner {{getPartnerColorMap}}"
          >{{record['搭档身份'] || '—'}}</view
        >
      </view>
      <view class="w-25 record-grid record-grid-padding-left-right">
        <view class="record-set-card {{getSetCardColorMap}}">
          {{record['日卡'] || '—'}}
          <text wx:if="{{record['日卡'] !== '无套装'}}"
            >{{record['阶数']}}</text
          >
        </view>
      </view>
      <view class="w-25 record-grid record-grid-padding-left">
        <view class="record-weapon {{getWeaponClass}}"
          >{{record['武器'] || '—'}}</view
        >
      </view>
    </view>
    <view class="row">
      <view class="w-50 record-grid record-flex-row record-grid-padding-right">
        <label class="record-text-label">攻击:</label>
        <label class="record-number-label">{{record['攻击'] || '—'}}</label>
      </view>
      <view class="w-50 record-grid record-flex-row record-grid-padding-left">
        <label class="record-text-label">生命:</label>
        <label class="record-number-label">{{record['生命'] || '—'}}</label>
      </view>
    </view>
    <view class="row">
      <view class="w-50 record-grid record-flex-row record-grid-padding-right">
        <label class="record-text-label">防御:</label>
        <label class="record-number-label">{{record['防御'] || '—'}}</label>
      </view>
      <view class="w-50 record-grid record-flex-row record-grid-padding-left">
        <label class="record-text-label">虚弱增伤:</label>
        <label class="record-number-label">{{record['虚弱增伤']}}%</label>
      </view>
    </view>
    <view class="row">
      <view class="w-50 record-grid record-flex-row record-grid-padding-right">
        <label class="record-text-label">暴击:</label>
        <label class="record-number-label">{{record['暴击']}}%</label>
      </view>
      <view class="w-50 record-grid record-flex-row record-grid-padding-left">
        <label class="record-text-label">暴伤:</label>
        <label class="record-number-label">{{record['暴伤']}}%</label>
      </view>
    </view>
    <view class="row">
      <view class="w-50 record-grid record-flex-row record-grid-padding-right">
        <label class="record-text-label">誓约增伤:</label>
        <label class="record-number-label"
          >{{record['誓约增伤'] ? record['誓约增伤']+'%' : '—'}}</label
        >
      </view>
      <view class="w-50 record-grid record-flex-row record-grid-padding-left">
        <label class="record-text-label">誓约回能:</label>
        <label class="record-number-label"
          >{{record['誓约回能']? record['誓约回能']+'%' : '—'}}</label
        >
      </view>
    </view>
    <view class="row">
      <view class="w-50 record-grid record-flex-row record-grid-padding-right">
        <label class="record-text-label">加速回能:</label>
        <label class="record-number-label"
          >{{record['加速回能'] ? record['加速回能']+'%' : '—'}}</label
        >
      </view>
      <view class="w-50 record-grid record-flex-row record-grid-padding-left">
        <label class="record-text-label">卡总等级:</label>
        <label class="record-number-label"
          >{{record['卡总等级'] ? record['卡总等级'] : '无数据'}}</label
        >
      </view>
    </view>
    <view
      class="row"
      wx:if="{{record['加成'] != '<nil>' && record['加成'] != ''}}"
    >
      <view class="w-50 record-grid record-flex-row record-grid-padding-right">
        <label class="record-text-label">赛季加成:</label>
        <label class="record-number-label">{{record['加成']}}%</label>
      </view>
    </view>
    <view
      class="row"
      wx:if="{{record['备注'] != '<nil>' && record['备注'] != ''}}"
    >
      <label class="note"
        >{{record['nickname'] ? record['nickname'] + '说' : '备注'}}:
        {{record['备注']}}</label
      >
    </view>
  </view>
  <view class="admin-actions" wx:if="{{showAdminActions}}">
    <view class="admin-action-edit" bind:tap="onEdit">
      <svg
        class="record-matching-circle"
        src="/assets/pencil.svg"
        width="15px"
        height="15px"
        color="lightgrey"
      ></svg>
    </view>
    <view class="admin-action-delete" bind:tap="onDelete">
      <svg
        class="record-matching-circle"
        src="/assets/trash.svg"
        width="15px"
        height="15px"
        color="lightgrey"
      ></svg>
    </view>
  </view>
</view>
